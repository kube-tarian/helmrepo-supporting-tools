apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: mutate-metric-relabeling
spec:
  rules:
  - name: mutate-metric-relabelings
    match:
      resources:
        kinds:
        - ServiceMonitor
    mutate:
      patchesJson6902: |-
        - op: add
          path: /spec/endpoints/0/metricRelabelings
          value:
            - action: replace
              regex: '.*'
              replacement: 'capten-controlplane'
              separator: ';'
              targetLabel: 'cluster_name'
